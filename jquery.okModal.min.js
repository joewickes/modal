!function(a){"use strict";var b=function(b,c){this.selector=b,this.settings=c,this.container=this.settings.container.jquery?this.settings.container:a(this.settings.container),this.modal=a("."+this.settings.modalName,this.container),this.modalInside=a("."+this.settings.modalName+"-inside",this.container),this.overlay=a("."+this.settings.overlayName,this.container),this.loader=a("."+this.settings.loaderName,this.container),this.Initialize.call(this)};b.prototype={Initialize:function(){this.settings.autoOpen||!this.selector?this.open():this.settings.eventDelegation!==!1&&"object"==typeof this.settings.delegatedSelector?a(this.selector).off(".okModal").on("click.okModal",this.settings.delegatedSelector,a.proxy(this.open,this)):a(this.selector).off(".okModal").on("click.okModal",a.proxy(this.open,this))},events:function(){a(document).on("updateModal.okModal ajaxComplete.okModal",a.proxy(this.adjustModal,this)),a(window).on("resize.okModal scroll.okModal",a.proxy(this.adjustModal,this)),a(document).on("keydown.okModal closeModal.okModal",a.proxy(this.close,this)),this.modal.on("click.okModal","."+this.settings.closeModalName,a.proxy(this.close,this)),this.modal.on("click.okModal",".ok-"+this.settings.closeModalName,a.proxy(this.close,this)),a("."+this.settings.closeModalName,this.modal).on("click.okModal",a.proxy(this.close,this)),a(".ok-"+this.settings.closeModalName,this.modal).on("click.okModal",a.proxy(this.close,this)),this.settings.closeOnDocumentClick&&(this.overlay.off(".okModal").on("click.okModal",a.proxy(this.close,this)),a("."+this.settings.modalName+", ."+this.settings.overlayName).on("click.okModal",a.proxy(function(b){var c=a(b.target);c.parents().is("."+this.settings.modalName+"-inside")||c.is("."+this.settings.modalName+"-inside")||this.close()},this))),this.settings.afterOpen.call(this,a(this.selector))},open:function(b){var c,d;(this.settings.eventDelegation!==!0||a(b.target).closest(this.settings.delegatedSelector).length)&&("object"==typeof b&&(b.preventDefault(),b.stopPropagation()),this.settings.ajax?this.settings.ajaxUrl?d=this.settings.ajaxUrl:a(this.selector).attr("href")?d=a(this.selector).attr("href"):"undefined"!=typeof b&&(a(b.currentTarget).attr("href")?d=a(b.currentTarget).attr("href"):a(b.currentTarget).closest("a").attr("href")&&(d=a(b.currentTarget).closest("a").attr("href"))):this.settings.iframe&&(d=this.settings.iframe),this.appendMarkup(),this.settings.insideMarkup?(this.modalInside.empty().append(this.settings.insideMarkup),this.afterLoad()):this.settings.iframe?(c=a(this.settings.iframeWrap).append('<div class="ok-'+this.settings.closeModalName+'"></div><iframe src="'+d+'"></iframe>'),this.modalInside.empty(),this.modalInside.append('<div class="ok-'+this.settings.closeModalName+'"><span>X</span></div>'),this.modalInside.append(c),this.modal.addClass("iframe"),this.afterLoad()):"undefined"!=typeof d&&d&&this.ajaxLoad(d),this.settings.allowClose?a(".ok-"+this.settings.closeModalName,this.modal).show():a(".ok-"+this.settings.closeModalName,this.modal).hide(),this.settings.afterInit.call(this,a(this.selector)))},close:function(b){var c,d,e="object"==typeof b&&"undefined"!=typeof b.type?b.type:!1,f="keydown"===e||"keyup"===e||"keypress"===e?!0:!1;if("object"==typeof b){if(f&&27!==b.keyCode||b.altKey||b.ctrlKey||b.metaKey||b.shiftKey)return;b.preventDefault(),b.stopPropagation()}a("."+this.settings.modalName).length&&(this.settings.onBeforeClose.call(this,a(this.selector)),(this.settings.allowClose||"closeModal"===e||"ajaxComplete"===e)&&this.modal.length&&(c=this.modal,d=this.overlay,c.animate({opacity:"hide"},this.settings.animSpeed),d.animate({opacity:"hide"},this.settings.animSpeed,a.proxy(function(){c.remove(),d.remove(),a("."+this.settings.closeModalName,c).off(".okModal"),c.off(".okModal"),d.off(".okModal"),a(".ok-modal").length||(a(window).off(".okModal"),a(document).off(".okModal"))},this)),this.settings.afterClose.call(this,a(this.selector))))},ajaxLoad:function(b){var c=this,d={url:b,type:c.settings.ajaxType,data:c.settings.ajaxData,global:c.settings.ajaxGlobal};this.modal.addClass("loading"),this.modal.is(":hidden")&&(this.modal.hide().animate({opacity:"show"},this.settings.animSpeed),this.loader.animate({opacity:"show"},this.settings.animSpeed),this.overlay.hide().animate({opacity:"show"},this.settings.animSpeed)),d=a.extend({},d,c.settings.ajaxSettings),d.success=function(b,d,e){var f=b;c.loader.animate({opacity:"hide"},c.settings.animSpeed,function(){"object"==typeof b&&("string"==typeof b.html?b=b.html:"string"==typeof b.view&&(b=b.view)),f=c.settings.ajaxFragment?a(c.settings.ajaxFragment,a(b)).html():a(b),c.settings.centered||c.modal.css({marginTop:-c.modal.height()}).hide().animate({opacity:"show",marginTop:c.settings.centeredOffset},c.settings.animSpeed+100,a.proxy(c.adjustModal,c)),c.modalInside.empty().append(f).hide().animate({opacity:"show"},c.settings.animSpeed),c.afterLoad("ajaxLoad"),c.settings.afterAjaxSuccess.call(c,b,e)})},d.error=function(a,b,d){c.loader.animate({opacity:"hide"},c.settings.animSpeed,function(){c.settings.afterAjaxError.call(c,a,d),c.close()})},d.complete=function(a){c.modal.removeClass("loading"),c.settings.afterAjaxComplete.call(c,a)},a.ajax(d)},afterLoad:function(){this.modal.is(":hidden")?this.settings.centered?(this.modal.hide().animate({opacity:"show"},this.settings.animSpeed,a.proxy(this.events,this)),this.overlay.hide().animate({opacity:"show"},this.settings.animSpeed)):(this.modal.css({marginTop:-this.modal.height()}),this.modal.hide().animate({opacity:"show",marginTop:this.settings.centeredOffset},this.settings.animSpeed,a.proxy(this.events,this)),this.overlay.hide().animate({opacity:"show"},this.settings.animSpeed)):this.events(),this.adjustModal(),this.modal.find("[autofocus=autofocus]").focus(),this.settings.afterLoad.call(this,a(this.selector))},adjustModal:function(){if(this.modal.length&&this.modalInside.length){var b,c,d,e=a(window).height(),f=a(window).width(),g=!1,h=this.settings.centered?0:this.settings.centeredOffset;d=this.modalInside.outerWidth(),c=this.modal.outerHeight(),c=this.settings.centered?this.modal.outerHeight():this.modal.outerHeight()+2*h,e>c&&f>d?(g=parseInt(this.modal.css("marginTop")),a.isNumeric(g)&&(g=Math.abs(g)),"body"===this.settings.container&&this.modal.removeClass("static").addClass("fixed"),this.settings.centered?g!==c/2&&this.modal.addClass("centered fixed").removeClass("static").css({top:"50%",marginTop:-c/2,marginBottom:0}):this.modal.removeClass("centered static").addClass("fixed").css({top:0,marginTop:h,marginBottom:h})):this.modal.hasClass("static")||(b=a(window).scrollTop()-this.container.offset().top,b=50>b&&0===h?0:b+h,this.modal.removeClass("centered fixed").addClass("static").css({top:0,marginTop:b,marginBottom:0}))}},appendMarkup:function(){var b=a("."+this.settings.modalName,this.container),c=(a("."+this.settings.modalName+"-inside",this.container),a('<div class="'+this.settings.overlayName+" modal-"+this.settings.modalSkin+'"></div>							<div class="'+this.settings.modalName+" modal-"+this.settings.modalSkin+'">								<div class="'+this.settings.loaderName+'"></div>								<div class="'+this.settings.modalName+'-inside"></div>							</div>'));this.container.css({position:"relative"}),this.settings.allowClose||a("."+this.settings.modalName,c).addClass("no-close"),"body"===this.settings.container&&c.addClass("fixed"),b.length?(this.modal.remove(),this.overlay.remove(),this.container.append(c)):this.container.append(c),this.modal=a("."+this.settings.modalName,this.container),this.modalInside=a("."+this.settings.modalName+"-inside",this.container),this.overlay=a("."+this.settings.overlayName,this.container),this.loader=a("."+this.settings.loaderName,this.container),this.settings.modalWidth&&this.modalInside.css({"max-width":this.settings.modalWidth})}},a.fn.okModal=function(c){return"object"==typeof c||"undefined"==typeof c?this.each(function(){var d=a.extend(!0,{},a.fn.okModal.defaults,c),e=new b(this,d);return a(this).data("okModal",e),this}):"string"==typeof c?this.each(function(){var b=a(this).data("okModal");return"object"==typeof b&&("adjust"===c&&a.isFunction(b.adjustModal)?b.adjustModal():"close"===c&&a.isFunction(b.close)&&b.close()),this}):void 0},a.okModal=function(c){if("object"==typeof c||"undefined"==typeof c){var d=a.extend(!0,{},a.fn.okModal.defaults,c),e=new b(!1,d);a(document).data("okModal",e)}else if("string"==typeof c){var f=a(document).data("okModal");"object"==typeof f&&("adjust"===c&&a.isFunction(f.adjustModal)?f.adjustModal():"close"===c&&a.isFunction(f.close)&&f.close())}},a.fn.okModal.defaults={modalName:"ok-modal",loaderName:"ok-modal-loader",overlayName:"ok-modal-overlay",closeModalName:"close-modal",loadInsideName:"load-inside",modalSkin:"default",container:"body",centered:!0,centeredOffset:50,fixed:!0,animSpeed:150,modalWidth:800,insideMarkup:!1,autoOpen:!1,allowClose:!0,eventDelegation:!1,delegatedSelector:!1,closeOnDocumentClick:!0,iframe:!1,iframeWrap:'<div class="modal-wrap" />',ajax:!1,ajaxType:"GET",ajaxFragment:!1,ajaxUrl:!1,ajaxData:!1,ajaxGlobal:!0,ajaxSettings:{},afterInit:a.noop,afterOpen:a.noop,afterClose:a.noop,afterLoad:a.noop,afterAjaxSuccess:a.noop,afterAjaxComplete:a.noop,afterAjaxError:a.noop,onBeforeClose:a.noop}}(jQuery);